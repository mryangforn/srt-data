(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-49a8bff5"],{"214d":function(t,a,e){"use strict";e.d(a,"f",(function(){return r})),e.d(a,"e",(function(){return n})),e.d(a,"d",(function(){return d})),e.d(a,"a",(function(){return s})),e.d(a,"g",(function(){return o})),e.d(a,"c",(function(){return c})),e.d(a,"b",(function(){return l}));var i=e("b775");function r(t){return Object(i["a"])({url:"/data/visual/boards/page",method:"get",params:t})}function n(t){return Object(i["a"])({url:"/data/visual/boards/"+t,method:"get"})}function d(t){return Object(i["a"])({url:"/data/visual/boards/"+t,method:"delete"})}function s(t){return Object(i["a"])({url:"/data/visual/boards",method:"post",data:t})}function o(t){return Object(i["a"])({url:"/data/visual/boards/"+t.id,method:"put",data:t})}function c(t){return Object(i["a"])({url:"/data/visual/boards/copy/"+t,method:"post"})}function l(t){return Object(i["a"])({url:"/data/visual/boards/build/"+t.id,method:"put",data:t})}},"29f6":function(t,a,e){"use strict";e("e03a")},"5d62":function(t,a,e){"use strict";e.d(a,"a",(function(){return i})),e.d(a,"b",(function(){return r}));e("ace4"),e("d3b7"),e("ac1f"),e("466d"),e("5cc6"),e("9a8c"),e("a975"),e("735e"),e("c1ac"),e("d139"),e("3a7b"),e("d5d6"),e("82f8"),e("e91f"),e("60bd"),e("5f96"),e("3280"),e("3fcc"),e("ca91"),e("25a1"),e("cd26"),e("3c5d"),e("2954"),e("649e"),e("219c"),e("170b"),e("b39a"),e("72f7");function i(t,a){var e=new FileReader;return e.readAsDataURL(t),new Promise((function(i,r){e.onload=function(e){var r=new Image;r.src=e.target.result,r.onload=function(){var e,r=a.width,n=a.height,d=document.createElement("canvas"),s=d.getContext("2d");d.setAttribute("width",r),d.setAttribute("height",n),s.drawImage(this,0,0,r,n),e=d.toDataURL(t["type"],a.quality),i(e)}}}))}function r(t){var a=t.split(","),e=a[0].match(/:(.*?);/)[1],i=atob(a[1]),r=i.length,n=new Uint8Array(r);while(r--)n[r]=i.charCodeAt(r);return new Blob([n],{type:e})}},c740:function(t,a,e){"use strict";var i=e("23e7"),r=e("b727").findIndex,n=e("44d2"),d=e("ae40"),s="findIndex",o=!0,c=d(s);s in[]&&Array(1)[s]((function(){o=!1})),i({target:"Array",proto:!0,forced:o||!c},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n(s)},e03a:function(t,a,e){},e440:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"board-container"},[e("div",{staticClass:"widget-left-container"},[e("div",{staticClass:"widget-left-header"},[e("span",[t._v(t._s(t.dataBoard.boardName))])]),e("div",{staticClass:"widget-left-wrapper"},[e("ul",{staticClass:"list-group"},t._l(t.dataChartList,(function(a,i){return e("li",{key:a.id,staticClass:"list-group-item"},[e("div",{staticClass:"list-group-item-text"},[t._v(t._s(a.chartName))]),e("div",{staticClass:"list-group-item-button"},[e("el-button",{attrs:{icon:"el-icon-plus",type:"text",size:"mini",disabled:a.disabled},on:{click:function(e){return t.handleAddChart(a)}}})],1)])})),0)])]),e("div",{staticClass:"widget-center-container"},[e("div",{staticClass:"widget-center-header"},[e("div",{staticClass:"widget-center-header-collapse",on:{click:function(a){t.drawer=!0}}},[e("i",{staticClass:"el-icon-info"})]),e("div",{staticClass:"widget-center-header-button"},[e("el-button",{attrs:{icon:"el-icon-view",type:"text"},on:{click:t.handlePreview}},[t._v(" 预览 ")]),e("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:t.handleReset}},[t._v(" 重置 ")]),e("el-button",{directives:[{name:"hasPerm",rawName:"v-hasPerm",value:["visual:board:build"],expression:"['visual:board:build']"}],attrs:{icon:"el-icon-plus",type:"text"},on:{click:t.handleSubmit}},[t._v(" 保存 ")]),e("el-button",{attrs:{icon:"el-icon-close",type:"text"},on:{click:t.handleCancel}},[t._v(" 取消 ")])],1)]),e("div",{staticClass:"widget-center-wrapper"},[e("grid-layout",{staticStyle:{border:"1px dashed #999",height:"100%","overflow-x":"hidden","overflow-y":"auto"},attrs:{layout:t.layout,"col-num":24,"row-height":30,"is-draggable":!0,"is-resizable":!0,"is-mirrored":!1,"vertical-compact":!0,"use-css-transforms":!0,"pane-container":!1,margin:[10,10]},on:{"update:layout":function(a){t.layout=a}}},t._l(t.layout,(function(a){return e("grid-item",{key:a.i,attrs:{x:a.x,y:a.y,w:a.w,h:a.h,i:a.i,"drag-allow-from":".vue-draggable-handle"},on:{resized:t.handleResize}},[e("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.getChartItem(a.i).loading,expression:"getChartItem(item.i).loading"}],staticClass:"widget-center-card",attrs:{"body-style":"padding: 10px;"}},[e("div",{staticClass:"widget-center-card-header vue-draggable-handle",attrs:{slot:"header"},slot:"header"},[e("div",[e("span",[t._v(t._s(t.getChartItem(a.i).chartName))])]),e("div",[e("i",{staticClass:"el-icon-delete",on:{click:function(e){return t.handleDeleteChart(a.i)}}}),e("i",{staticClass:"el-icon-setting",on:{click:function(e){return t.handleTimerChart(a.i)}}})])]),t.getChartItem(a.i).visible?e("chart-panel",{key:a.i,ref:"charts"+a.i,refInFor:!0,attrs:{"chart-schema":t.getChartItem(a.i).chartSchema,"chart-data":t.getChartItem(a.i).data,"chart-style":{height:30*a.h+10*(a.h-1)-60+"px"}}}):e("div",{style:{height:30*a.h+10*(a.h-1)-60+"px"}})],1)],1)})),1)],1)]),e("el-drawer",{attrs:{size:"300px",visible:t.drawer,"with-header":!1},on:{"update:visible":function(a){t.drawer=a}}},[e("div",{staticClass:"widget-board-form"},[e("el-form",{attrs:{size:"mini","label-position":"top"}},[e("el-form-item",{attrs:{label:"看板名称"}},[e("el-input",{attrs:{size:"mini",disabled:!0},model:{value:t.dataBoard.boardName,callback:function(a){t.$set(t.dataBoard,"boardName",a)},expression:"dataBoard.boardName"}})],1),e("el-form-item",{attrs:{label:"缩略图"}},[e("el-upload",{class:{hideUpload:t.hideUpload},attrs:{action:"#",accept:".png, .jpg, .jpeg","list-type":"picture-card",limit:1,"auto-upload":!1,"before-upload":t.beforeUpload,"on-change":t.handleChange,"on-remove":t.handleRemove,"file-list":t.fileList}},[e("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})])],1)],1)],1)])],1)},r=[],n=(e("7db0"),e("c740"),e("a434"),e("e9c4"),e("b64b"),e("d3b7"),e("3ca3"),e("159b"),e("ddb0"),e("2b3d"),e("9861"),e("214d")),d=e("1dc5"),s=e("7be8"),o=e.n(s),c=e("3a5b"),l=e("5d62"),u={name:"DataBoardBuild",components:{GridLayout:o.a.GridLayout,GridItem:o.a.GridItem,ChartPanel:c["default"]},data:function(){return{dataBoard:{},dataChartList:[],layout:[],interval:[],charts:[],drawer:!1,fileList:[],hideUpload:!1}},created:function(){this.getDataBoard(this.$route.params.id),this.getDataChartList()},methods:{getDataBoard:function(t){var a=this;Object(n["e"])(t).then((function(t){if(t.success){if(a.dataBoard=t.data,a.dataBoard.boardThumbnail){var e=Object(l["b"])(a.dataBoard.boardThumbnail),i=URL.createObjectURL(e);a.fileList.push({url:i}),a.hideUpload=!0}a.layout=a.dataBoard.boardConfig?JSON.parse(JSON.stringify(a.dataBoard.boardConfig.layout)):[],a.interval=a.dataBoard.boardConfig?JSON.parse(JSON.stringify(a.dataBoard.boardConfig.interval)):[];var r=a.dataBoard.charts?JSON.parse(JSON.stringify(a.dataBoard.charts)):[];r.forEach((function(t,e,i){a.parserChart(t)})),a.charts=r}}))},parserChart:function(t){var a=this;this.$set(t,"loading",!0),t.chartConfig?Object(d["d"])(JSON.parse(t.chartConfig)).then((function(e){e.success&&(a.$set(t,"data",e.data.data),a.$set(t,"chartSchema",JSON.parse(t.chartConfig)),a.$set(t,"loading",!1),a.$set(t,"visible",!0))})):this.$set(t,"loading",!1)},getChartItem:function(t){return this.charts.find((function(a){return a.id===t}))},getDataChartList:function(){var t=this;Object(d["g"])().then((function(a){a.success&&(t.dataChartList=a.data)}))},handleAddChart:function(t){var a=this,e=this.layout.findIndex((function(a){return a.i===t.id}));-1===e?Object(d["f"])(t.id).then((function(e){if(e.success){var i={x:0,y:0,w:12,h:9,i:t.id};a.layout.push(i);var r=e.data;a.parserChart(r),a.charts.push(r),a.$set(t,"disabled",!0)}})):this.$set(t,"disabled",!0)},handleDeleteChart:function(t){this.layout.splice(this.layout.findIndex((function(a){return a.i===t})),1),this.charts.splice(this.charts.findIndex((function(a){return a.id===t})),1),this.$set(this.dataChartList.find((function(a){return a.id===t})),"disabled",!1)},handleTimerChart:function(t){var a=this;this.$prompt("请输入定时时间间隔，输入0不定时（单位毫秒，1000 毫秒 = 1 秒）","提示",{showClose:!1,closeOnClickModal:!1,confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^(0|\+?[1-9][0-9]*)$/,inputErrorMessage:"格式不正确",inputValue:"5000"}).then((function(e){var i=e.value,r=a.interval.find((function(a){return a.id===t}));r?a.$set(r,"milliseconds",i):a.interval.push({id:t,milliseconds:i})})).catch((function(){}))},handlePreview:function(){var t=this.$router.resolve({path:"/visual/board/view/".concat(this.dataBoard.id)});window.open(t.href,"_blank")},handleReset:function(){var t=this;this.layout=this.dataBoard.boardConfig?JSON.parse(JSON.stringify(this.dataBoard.boardConfig.layout)):[],this.interval=this.dataBoard.boardConfig?JSON.parse(JSON.stringify(this.dataBoard.boardConfig.interval)):[];var a=this.dataBoard.charts?JSON.parse(JSON.stringify(this.dataBoard.charts)):[];a.forEach((function(a,e,i){t.parserChart(a)})),this.charts=a,this.dataChartList.forEach((function(e,i,r){-1===a.findIndex((function(t){return t.id===e.id}))?t.$set(e,"disabled",!1):t.$set(e,"disabled",!0)}))},handleSubmit:function(){var t=this,a={id:this.dataBoard.id,boardThumbnail:this.dataBoard.boardThumbnail,boardConfig:{layout:this.layout,interval:this.interval}};Object(n["b"])(a).then((function(a){a.success&&t.$message.success("保存成功")}))},handleCancel:function(){window.location.href="about:blank",window.close()},handleResize:function(t,a,e,i,r){this.charts.find((function(a){return a.id===t})).visible&&this.$refs["charts".concat(t)][0].$children[0].$emit("resized")},beforeUpload:function(t){var a=t.size/1024/1024<2;return a||this.$message.error("上传图片大小不能超过 2MB"),a},handleChange:function(t,a){var e=this;this.hideUpload=a.length>=1;var i={width:250,height:150,quality:.8};Object(l["a"])(t.raw,i).then((function(t){e.$set(e.dataBoard,"boardThumbnail",t)}))},handleRemove:function(t,a){this.hideUpload=a.length>=1,this.$set(this.dataBoard,"boardThumbnail","x")}}},h=u,f=(e("29f6"),e("2877")),b=Object(f["a"])(h,i,r,!1,null,"69353cba",null);a["default"]=b.exports}}]);